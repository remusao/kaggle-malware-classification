#!/usr/bin/env python
# -*- coding: utf-8 -*-

"""
Usage:
    predict <model> <data_test.hdf5>
    predict -h | --help

Options:
    -h, --help      Show help
"""


from __future__ import print_function
from sklearn.externals import joblib
import docopt
import h5py
import utils


def main():
    args = docopt.docopt(__doc__)

    # Load classifier
    clf = utils.load_classifier(args['<model>'])

    if clf is not None:
        # Load test data
        print("Load test data")
        with h5py.File(args['<data_test.hdf5>'], 'r') as f:
            X = f['X'].value

            # Make prediction
            print("Make prediction")
            y = clf.predict_proba(X)

            # Dump prediction
            print("Dump predictions")
            with h5py.File('prediction.hdf5', 'w') as f_predict:
                f_predict.create_dataset(
                    'Y',
                    y.shape,
                    dtype='f',
                    data=y)
                f_predict.create_dataset('IDS', data=f['IDS'].value)


if __name__ == "__main__":
    main()
